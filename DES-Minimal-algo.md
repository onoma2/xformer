# MINIMAL Algorithm Design - Signal Flow Plan

## Objective
Design the MINIMAL algorithm implementation using TuesdayTrack's 14 existing parameters, showing complete signal flow from parameter input to CV/Gate output.

---

## Part 1: Parameter & State Architecture

### 1. User Parameters (Sequence-Determined)
*Stored in `TuesdaySequence`. Saved with Project. Controlled by User.*

**Core Algorithm Control**
| Parameter | Range | Purpose |
|-----------|-------|---------|
| **algorithm** | 0-20 | Algorithm selector (e.g., MINIMAL, STOMPER) |
| **flow** | 0-16 | Primary RNG seed & Structure control |
| **ornament** | 0-16 | Secondary RNG seed & Detail/Density control |
| **power** | 0-16 | Gate density / Cooldown control |

**Musical & Loop**
| Parameter | Range | Purpose |
|-----------|-------|---------|
| **loopLength** | 0-29 | 0=Infinite, 1-29=Fixed step loop |
| **scale** | -1 to Count | Scale selection (-1=Project) |
| **rootNote** | -1 to 11 | Root note override |
| **octave** | -10 to +10 | Global octave shift |
| **transpose** | -11 to +11 | Global degree shift |

**Articulation & Timing**
| Parameter | Range | Purpose |
|-----------|-------|---------|
| **glide** | 0-100% | Slide probability |
| **trill** | 0-100% | Retrigger/Subdivision probability |
| **gateLength** | 0-100% | Gate duration scaler |
| **gateOffset** | 0-100% | Micro-timing shift |
| **divisor** | varies | Step clock division (1/16, etc.) |
| **resetMeasure**| 0-128 | Force reset every N bars |

### Velocity-Dependent Cooldown Curve (Power Parameter)
The density logic is a **Dynamic Threshold**, not a fixed period.
1.  **Base Rule:** A gate fires when `_coolDown` reaches 0. This takes `17 - Power` steps.
2.  **Velocity Override:** A gate *also* fires if `velocity / 16 >= _coolDown`.
    *   High velocity notes (accents) can "break through" the cooldown early.
    *   **Example:** At Power 1 (Base 16), a standard note might wait 16 steps. But a high velocity note (200+) can trigger when cooldown drops to ~12 (every 4 steps).
    *   **Musicality:** Louder/important notes are preserved even at low density settings.

---

### 2. Algorithm State (Persistence)
*Stored in `TuesdayTrackEngine`. Runtime RAM only. "Remembers" context between steps.*

**Common State**
- `_rng`, `_extraRng`: The random number generators (seeded by Flow/Ornament).
- `_stepIndex`: Current step position.

**Algorithm-Specific State (MINIMAL Example)**
| Variable | Type | Purpose |
|----------|------|---------|
| `_minimal_mode` | 0/1 | Current state: SILENCE or BURST |
| `_minimal_burstTimer` | int | Steps remaining in current burst |
| `_minimal_silenceTimer`| int | Steps remaining in current silence |
| `_minimal_noteIndex` | int | Current position in melody scale |
| `_minimal_clickDensity`| int | Cached density threshold (from Ornament) |

---

### 3. Tick Properties (Transient Flags)
*Generated by Algorithm. Passed to Engine. Valid for **one step** only.*

**The `TuesdayTickResult` Struct**
| Property | Purpose | MINIMAL Usage |
|----------|---------|---------------|
| **note** | Scale degree index | generated from `noteIndex` |
| **octave** | Octave offset | generated from `noteIndex` |
| **velocity** | 0-255 (0=Rest) | 0 in Silence, 128-255 in Burst |
| **accent** | bool (Force/Boost) | false (MINIMAL uses velocity/density only) |
| **gateRatio** | 0-100% duration | Randomized 25-50% (staccato) |
| **slide** | bool (Glide) | `glide` prob check (Linear Ramp) |
| **chaos** | 0-100 (Intensity) | `trill` prob check (triggers sub-events) |
| **polyCount**| int (Subdivisions) | 3 (Triplets) if Trill active |
| **isSpatial**| bool (Spread/Rapid)| `false` for Trill (rapid), `true` for Poly |
| **noteOffsets**| int8_t[8] | Micro-sequencing intervals (unused in MINIMAL) |

---

## Scale Parameter: Output Quantization (NOT Algorithm Control)

**IMPORTANT:** The `scale` parameter controls **output quantization** in `scaleToVolts()`.

**It does NOT affect algorithm behavior.** Algorithms generate note indices (scale degrees or semitones) and the quantization layer transforms them to voltages.

### Separation of Concerns

**Algorithm Stage** (`generateStep()`):
- Generates raw note indices (scale degrees or semitones)
- Scale-based algorithms use 0-6 (for 7-note scales)
- Chromatic algorithms can use 0-11 (semitones)
- **Algorithm does not know or care about quantization**

**Quantization Stage** (`scaleToVolts()`):
- Transforms note indices to voltages using selected scale
- Applies scale quantization, rootNote, transpose, octave
- **Scale 0 (Semitones) = all 12 semitones** (effectively chromatic)

**Example:** An algorithm that outputs note index 5 will produce:
- C Major scale (scale=1): G (5th degree of C major = G)
- Chromatic (scale=0): F (5th semitone from C = F)
- Project scale (scale=-1): Depends on project settings

---